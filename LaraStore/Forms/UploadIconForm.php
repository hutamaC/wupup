<?php

namespace LaraStore\Forms;
use App\User;
use Auth;

class UploadIconForm extends Form{

	
	/*
    |-------------------------------------------------------------------------------
    |
    | 注册表单验证规则
    |
    |-------------------------------------------------------------------------------
    */
    protected $rules = [
        'user_icon'     => 'required|image',
    ];


    /*
    |-------------------------------------------------------------------------------
    |
    | 注册表单验证规则提示信息
    |
    |-------------------------------------------------------------------------------
    */
    protected $messages = [
       	'user_icon.image' =>'请上传正确的图片格式',
    ];


    /*
    |-------------------------------------------------------------------------------
    |
    |  验证用户是否登录
    |
    |-------------------------------------------------------------------------------
    */
    protected function auth(){

    	return (Auth::check('user'))? true:false;
    }


    /*
    |-------------------------------------------------------------------------------
    |
    |  成功后返回
    |
    |-------------------------------------------------------------------------------
    */
    public function successRespond(){
    	$this->save();
    	return redirect('auth/center');
    }


    /*
    |-------------------------------------------------------------------------------
    |
    |  验证未通过返回错误信息
    |
    |-------------------------------------------------------------------------------
    */
    public function errorRespond(){

    	return redirect('auth/center')->with('errors',$this->errors());
    }



    /*
    |-------------------------------------------------------------------------------
    |
    | 存储注册表单中的数据到数据库
    |
    |-------------------------------------------------------------------------------
    */
    public function persist()
    {
         if(!$this->auth()){
         	return false;
         }

         if(!$this->isValid()){
         	return false;
         }
         $user 		= Auth::user('user');
         $user->img();
    }
}
